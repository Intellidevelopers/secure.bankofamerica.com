var counter=0;var heartBeatIntervalMs=5000;var maxCheckAttempts=3;var heartBeatEventsCounter=0;var heartBeatStatus="";var heartBeatInterval=heartBeatIntervalMs;var errorList={"ERROR(701)":"true","ERROR(702)":"true","ERROR(703)":"true","ERROR(704)":"true","ERROR(705)":"true","ERROR(706)":"true"};var captureUrl="";var pageUrl=window.location.href;var noIACPage=pageUrl.indexOf("/signOnSuccessRedirect.go")>-1||pageUrl.indexOf("staticweb")>-1;var mwebPage=pageUrl.indexOf("staticweb")>-1;var llePipeline="";var llemweb="";var lleUrlMweb="";var lleUrlHelixMweb="";if(mwebPage){llePipeline=mobilewebconfig.spartaRedirectionURI;lleUrlMweb=llePipeline.indexOf(".ecnp")>-1?true:false;lleUrlHelixMweb=llePipeline.indexOf("helix.ecnp")>-1?true:false;if(lleUrlMweb){if(lleUrlHelixMweb){llemweb=llePipeline.split("-")[1]}else{var lleNoHelix=llePipeline.split("-")[1].split(".")[0];if(lleNoHelix==="cert1"){llemweb="sit1a"}else if(lleNoHelix==="cert2"){llemweb="sit2a"}else{llemweb=lleNoHelix}}}}var sendCsidContext=function(csidCookieValue){var context="";var waitTimeout=250;if($(".online-id-vipaa-module .enter-skin").is(":visible")){context="login-secure-signin"}else if($(".acw-widget-module .request-skin").is(":visible")||$(".xsw-widget-module .xtra-security-req-skin").is(":visible")){context="Request-OTAC-Authorization"}else if($(".acw-widget-module .enter-skin").is(":visible")){context="Enter-OTAC-Authorization"}else if($(".inputEntryContainer .inputContainer").is(":visible")){context="mweb-login-signin"}if(typeof cdApi==="object"&&context!==""){cdApi.setCustomerSessionId(csidCookieValue);cdApi.changeContext(context);if(!mwebPage){triggerUiWebServerLogger("BehBio SDK is loaded with csid and pageContext",":"+csidCookieValue+":"+context)}performFlush()}else{if(counter<=60){if(counter>40){waitTimeout=1000}let multipler=counter>40?counter-30:counter;if(!mwebPage){triggerUiWebServerLogger("BehBio SDK is not loaded in miliseconds",":"+multipler*waitTimeout)}window.setTimeout(function(){sendCsidContext(csidCookieValue)},waitTimeout);counter=counter+1}else{if(!mwebPage){triggerUiWebServerLogger("BehBio SDK is not loaded due to web SDK error")}}}};var scriptLoadFunctions=function(){var waitTimeout=250;var csidCookie="";document.cookie.split("; ").forEach(function(row){if(row.startsWith("CSID=")){csidCookie=row.split("CSID=")[1].split(":")[0]}});if(mwebPage){if(typeof cdApi==="object"&&csidCookie){}else{if(counter<=60){if(counter>40){waitTimeout=1000}window.setTimeout(function(){scriptLoadFunctions()},waitTimeout);counter=counter+1}}}if(csidCookie){sendCsidContext(csidCookie)}else{if(!mwebPage){triggerUiWebServerLogger("BehBio SDK is not loaded due to cookie")}}};var callOptionB=function(){var scriptTagOptionB=document.createElement("script");var lleUrl=window.location.host.indexOf("helix.ecnp")>-1?true:false;var optionBAssetUrl="";if(lleUrl){optionBAssetUrl="https://uat-secure-"+window.location.host.split("-")[1]+"-helix.bac-assets.com/sparta/client/helper/spa-assets/components/utilities/client-helper/behbio/vendb-lle/4.0.0/js/vendb-lle.js"}else if(lleUrlMweb){optionBAssetUrl="https://uat-secure-"+llemweb+"-helix.bac-assets.com/sparta/client/helper/spa-assets/components/utilities/client-helper/behbio/vendb-lle/4.0.0/js/vendb-lle.js"}else{optionBAssetUrl="https://secure.bankofamerica.com/client/helper/spa-assets/components/utilities/client-helper/behbio/vendb/4.0.0/js/vendb.js"}scriptTagOptionB.setAttribute("src",optionBAssetUrl);if(typeof cdApi==="undefined"){document.getElementsByTagName("head")[0].appendChild(scriptTagOptionB)}};var triggerUiWebServerLogger=function(message,param){var uiLoggerLocation=window.location.host;var encryptedMessage=btoa(message);var encryptedHref=btoa(window.location.href);if(param===undefined){param=""}const appendErrorUrl="?m="+encryptedMessage+param+"&r="+encryptedHref;var uiLoggerUrl="";if(uiLoggerLocation.indexOf("secure")>-1){uiLoggerUrl="https://"+uiLoggerLocation+"/sparta/client/helper/client-assets/"}else{var unsecureUrlLocation=uiLoggerLocation.replace("www","secure");uiLoggerUrl="https://"+unsecureUrlLocation+"/sparta/client/helper/client-assets/"}var request=new XMLHttpRequest;request.open("https://secure.bankofamerica.com/pa/components/modules-app/VIPAA/online-id-vipaa-module/1.0/script/GET",uiLoggerUrl+appendErrorUrl,true);request.setRequestHeader("Content-type","application/json");request.setRequestHeader("accept","application/json");request.setRequestHeader("cache-control","no-cache");request.send()};var startListen=function(){_setHeartBeatListener();setInterval(_checkHeartBeatStatus.bind(this),this.heartBeatInterval)};var _setHeartBeatListener=function(){window.addEventListener("message",event=>{if(event.data.type==="cdHeartbeat"){this.heartBeatEventsCounter+=1;this.heartBeatStatus=event.data.data}})};var _checkHeartBeatStatus=function(){var ahvcCookieHeartBeat="";document.cookie.split("; ").forEach(function(row){if(row.startsWith("AHVC=")){ahvcCookieHeartBeat=row}});var ahvcCookieHeartBeatValue=ahvcCookieHeartBeat.split("invokeHeartBeat:")[1].split(":")[0];var ahvcCookieHeartBeatMwebValue=ahvcCookieHeartBeat.split("invokeHeartBeatMweb:")[1];if(mwebPage){if(ahvcCookieHeartBeatMwebValue==="true"){this.maxCheckAttempts-=1;if(this.maxCheckAttempts===0&&this.heartBeatEventsCounter===0){heartbeatapiCall("sdkBlocked")}if(this.heartBeatStatus==="Ok"){}else if(typeof this.heartBeatStatus==="object"){for(var errorCode in this.errorList){if(this.errorList[errorCode]==="true"){this.heartBeatStatus.forEach(function(code){if(code===errorCode){this.errorList[errorCode]="false";heartbeatapiCall()}})}}}}}else if(ahvcCookieHeartBeatValue==="true"){this.maxCheckAttempts-=1;if(this.maxCheckAttempts===0&&this.heartBeatEventsCounter===0){heartbeatapiCall("sdkBlocked")}if(this.heartBeatStatus==="Ok"){}else if(typeof this.heartBeatStatus==="object"){for(var errorCode in this.errorList){if(this.errorList[errorCode]==="true"){this.heartBeatStatus.forEach(function(code){if(code===errorCode){this.errorList[errorCode]="false";heartbeatapiCall()}})}}}}};var heartbeatapiCall=function(error){var captureApiLocation=window.location.host;var captureUrl="";if(captureApiLocation.indexOf("secure")>-1){captureUrl="https://"+captureApiLocation+"/login/rest/sas/sparta/v1/captureJsStatus"}else if(mwebPage){captureUrl="https://secure-"+llemweb+"-helix.ecnp.bankofamerica.com/login/rest/sas/sparta/v1/captureJsStatus"}else{var unsecureLocation=captureApiLocation.replace("www","secure");captureUrl="https://"+unsecureLocation+"/login/rest/sas/sparta/v1/captureJsStatus"}var requestPayload="";if(error==="sdkBlocked"){requestPayload={jsstatus:["ERROR(699)"]}}else{requestPayload={jsstatus:this.heartBeatStatus}}var request=new XMLHttpRequest;request.open("https://secure.bankofamerica.com/pa/components/modules-app/VIPAA/online-id-vipaa-module/1.0/script/POST",captureUrl,true);request.setRequestHeader("Content-type","application/json");request.setRequestHeader("accept","application/json");request.setRequestHeader("cache-control","no-cache");request.send(JSON.stringify(requestPayload))};var loadIac=function(){$.ajax({type:"GET",url:"/login/rest/sas/sparta/v2/iac?dfp=true",crossDomain:true,cache:false,timeout:60000,processData:false,xhrFields:{withCredentials:true},dataType:"text",headers:{"content-type":"application/json",accept:"application/json","cache-control":"no-cache"},error:function(XMLHTTPRequest,textStatus,errorThrown){if(!mwebPage){triggerUiWebServerLogger("BehBio SDK is not loaded due to iacall")}},success:function(data){scriptLoadFunctions()},complete:function(XMLHTTPRequest,textStatus){}})};callOptionB();if(!noIACPage){loadIac()}else{scriptLoadFunctions()}function flushdataevents(){var element_array=["signIn","passcode1","tlpvt-passcode-input","signin-with-mobile-app","signin-with-mobile-app-button","signin-pwdless","signin-pwdless-button","signin-pwdless-link","signin-with-mobile-app-link","signInWithMobileAppLink","signin-with-mobile-app-link-text","signin-with-passcode-text","signin-mobile-app","signin-with-passcode","signin-with-windows-hello","login_button","enterID-input","btCustomOnlineId","btCustomPasscode","btSignonContinue","signonLabel"];for(var i=0;i<element_array.length;i++){var checkElement=document.getElementById(element_array[i]);if(checkElement){checkElement.addEventListener("mouseenter",function(){cdApi.client.flush()},{capture:true});checkElement.addEventListener("mousedown",function(){cdApi.client.flush()},{capture:true});checkElement.addEventListener("keydown",function(event){if(event.keyCode==13||event.keyCode==32){cdApi.client.flush()}},{capture:true});checkElement.addEventListener("touchstart",function(){cdApi.client.flush()},{capture:true})}}};function performFlush(){if(document.readyState==="complete"){flushdataevents()}else{document.addEventListener("readystatechange",function(){if(document.readyState==="complete"){flushdataevents()}})}}startListen();
//# sourceMappingURL=./script-manager-login.js.map